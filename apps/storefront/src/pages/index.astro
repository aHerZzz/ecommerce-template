---
import BaseLayout from '../layouts/BaseLayout.astro';
import type { Product } from '../types/store';
import { StorefrontApp } from '../components/StorefrontApp';
import { fetchProducts } from '../services/products';
import { storeSettings } from '../config/store';

let productList: Product[] = [];
let productLoadError: string | null = null;
try {
  productList = await fetchProducts();
} catch (error) {
  productLoadError = (error as Error)?.message ?? 'No se pudo cargar el catálogo inicial.';
  console.error('No se pudo cargar el catálogo inicial', error);
}
---
<BaseLayout title={storeSettings.branding.storeName} description={storeSettings.branding.tagline}>
  <section class="flex flex-col gap-6">
    <div class="space-y-1">
      <h1 class="text-3xl font-bold">{storeSettings.branding.storeName}</h1>
      <p class="text-slate-600">{storeSettings.branding.tagline}</p>
    </div>
    {productLoadError ? (
      <div class="rounded-lg border border-amber-200 bg-amber-50 p-4 text-amber-900">
        <p class="font-semibold">No se pudo cargar el catálogo inicial.</p>
        <p class="text-sm mt-1">{productLoadError}</p>
        <ul class="mt-3 list-disc space-y-1 pl-5 text-sm">
          <li>Confirma la variable <code>PUBLIC_BACKEND_URL</code> en tu entorno.</li>
          <li>Si usas el backend local de Medusa, asegúrate de iniciarlo en <code>http://localhost:9000</code>.</li>
        </ul>
      </div>
    ) : (
      <StorefrontApp client:load products={productList} />
    )}
  </section>
</BaseLayout>
